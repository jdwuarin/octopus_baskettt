"use strict";angular.module("App",["ngCookies","ngRoute","ngAnimate","App.filters","App.services","App.directives","App.controllers"]).config(["$httpProvider",function(a){a.defaults.xsrfHeaderName="X-CSRFToken",a.defaults.xsrfCookieName="csrftoken",a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"static/app/partials/home.html",requireLogin:!1}).when("/signup",{controller:"RegistrationController",templateUrl:"static/app/partials/signup.html",requireLogin:!1}).when("/login",{controller:"LoginController",templateUrl:"static/app/partials/login.html",requireLogin:!1}).when("/basket",{controller:"ProductListController",templateUrl:"static/app/partials/product_list.html",requireLogin:!1}).when("/onboarding/:id",{controller:"OnboardingController",templateUrl:"static/app/partials/onboarding.html",requireLogin:!1}).when("/transfer",{controller:"TransferController",templateUrl:"static/app/partials/transfer.html",requireLogin:!0}).otherwise({redirectTo:""})}]).run(["$cookies","$http","$rootScope","User",function(a,b,c,d){b.defaults.headers.post["X-CSRFToken"]=a.csrftoken,b.defaults.headers.common["X-CSRFToken"]=a.csrftoken,c.$on("$routeChangeStart",function(a,b){if(d.isLoggedIn()||d.requestLoggedIn(function(a){a.success?d.setLoggedIn(!0):(d.setLoggedIn(!1),b.requireLogin&&d.redirect("/login"))}),"OnboardingController"===b.controller){var c=parseInt(b.params.id,10);(0===c||c>2)&&d.redirect("/")}})}]),angular.module("App.controllers",["ngSanitize","ui.bootstrap"]).controller("OnboardingController",["$scope","$routeParams","Preference",function(a,b,c){a.cuisines=[{name:"Italian",image:"italian.png"},{name:"Chinese",image:"chinese.png"},{name:"Indian",image:"indian.png"},{name:"Spanish",image:"spanish.png"},{name:"Thai",image:"thai.png"},{name:"French",image:"french.png"}],a.preference={};var d=parseInt(b.id,10);a.page=d,a.saveData=function(){c.setParameters(a.preference)},a.isActive=function(a){return a===d},a.getNextPage=function(){return 2>d&&d>0?"#/onboarding/"+(d+1).toString():2===d?"#/basket":"#/"}}]).controller("ProductListController",["$rootScope","$scope","Preference","Basket","Product","User","Tesco","Alert",function(a,b,c,d,e,f,g,h){var i=c.getAll();b.user={},b.tescoCredential={},b.search_result={},a.$on("CloseSignUpForm",function(){b.closeForm(),b.toggleTescoForm(!0)}),a.$on("removeProduct",function(a,c){b.products.splice(c,1),b.$apply()}),d.post(i,function(a){b.products=a}),b.searchProducts=function(){b.queryTerm?e.search(b.queryTerm,function(a){b.search_result=a},function(){h.add("Could find this product","danger"),b.search_result={}}):b.search_result={}},b.transferBasket=function(){f.isLoggedIn()?b.toggleTescoForm(!0):b.toggleForm(!0)},b.closeForm=function(){b.toggleForm(!1)},b.signup=function(){var c=b.user;b.signupForm.$valid&&f.signup(c.email,c.password,function(){a.$emit("UserSignedUp")})},b.sendToTesco=function(){var a=b.tescoCredential,c=b.products;b.tescoForm.$valid&&(b.toggleTescoForm(!1),b.viewLoading=!0,g.post(a.email,a.password,c,function(){b.viewLoading=!1,h.add("Your products have been transfered to Tesco","success")}))},b.closeTescoForm=function(){b.toggleTescoForm(!1)},b.addProduct=function(a){for(var c=b.products,d=!1,e=c.length-1;e>=0;e--)if(c[e].name===a.name){d=!0,c[e].quantity+=1;break}d?b.products=c:(a.quantity=1,b.products.push(a))}}]).controller("RegistrationController",["$scope","User",function(a,b){a.user={},a.signup=function(){var c=a.user;a.signupForm.$valid&&b.signup(c.email,c.password,function(){b.redirect("/")})}}]).controller("LoginController",["$sanitize","$scope","User","Alert",function(a,b,c,d){b.user={};var e=function(b){return{email:a(b.email),password:a(b.password)}};b.login=function(){var a=b.user;b.loginForm.$valid&&(a=e(a),c.login(a.email,a.password,function(){c.setLoggedIn(!0),d.add("Successfully logged in.","success"),c.redirect("/")}))}}]).controller("AlertController",["$scope","Alert",function(a,b){a.alerts=b.getAll(),a.closeAlert=function(c){b.close(c),a.alerts=b.getAll()}}]),angular.module("App.directives",[]).directive("click",["Preference",function(a){return function(b,c){var d=a.getCuisine(),e=d.some(function(a){return b.cuisine.name===a});b.selectedStatus=e,c.bind("click",function(){b.selectedStatus=!b.selectedStatus,a.setCuisine(b),b.$apply()})}}]).directive("signup",[function(){return{link:function(a){a.isVisible=!1,a.toggleForm=function(b){a.isVisible=b}},restrict:"E",templateUrl:"static/app/partials/_sign_up.html"}}]).directive("tesco",[function(){return{link:function(a){a.tescoIsVisible=!1,a.toggleTescoForm=function(b){a.tescoIsVisible=b}},restrict:"E",templateUrl:"static/app/partials/_tesco.html"}}]).directive("navbar",["$rootScope","User",function(a,b){return{link:function(c){a.$on("UserSignedUp",function(){b.requestLoggedIn(function(d){d.success&&(b.setLoggedIn(!0),c.userIsLoggedIn(),a.$emit("CloseSignUpForm"))})}),c.userIsLoggedIn=function(){return b.isLoggedIn()},c.logout=function(){b.logout(function(){b.setLoggedIn(!1),b.redirect("/")})}},restrict:"E",templateUrl:"static/app/partials/_nav_bar.html"}}]).directive("remove",["$rootScope",function(a){return{link:function(b,c){c.bind("click",function(){a.$emit("removeProduct",b.$index)})},template:'<button class="btn-gray btn-remove"><i class="glyphicon glyphicon-remove"></i></button>',transclude:!0}}]),angular.module("App.filters",[]).filter("filteredrecipes",[function(){return function(a,b){if(void 0!==a){var c,d=a.slice();return angular.forEach(b,function(a,b){if(a)for(var e=0;e<d.length;e++)c=d[e],-1==c.title.indexOf(b)&&d.splice(e--,1)}),d}}}]),angular.module("App.services",["LocalStorageModule"]).factory("Product",["$http",function(a){function b(a){return a="undefined"!=typeof a?a:"","http://127.0.0.1:8000/api/v1/product/"+a+"?format=json"}return{get:function(c,d){return a.get(b(c)).success(d)},query:function(c){return a.get(b()).success(c)},save:function(c,d){return a.post(b(),c).success(d)},remove:function(c,d){return a.delete(b(c)).success(d)},put:function(c,d){return a.put(b(c.id),c).success(d)},search:function(c,d,e){return a.get(b("search/")+"&term="+c).success(d).error(e)}}}]).factory("User",["$cookies","$http","$location",function(a,b,c){function d(a){return"http://127.0.0.1:8000/api/v1/user/"+a+"/?format=json"}var e=null;return{login:function(a,c,e){return b({url:d("login"),method:"POST",headers:{"Content-Type":"application/json"},data:{email:a,password:c}}).success(e)},logout:function(a){return b({url:d("logout"),method:"GET"}).success(a)},redirect:function(a){a=a||"/",c.path(a)},isLoggedIn:function(){return e},setLoggedIn:function(a){e=a},signup:function(a,c,e){return b({url:d("signup"),method:"POST",headers:{"Content-Type":"application/json"},data:{email:a,password:c}}).success(e)},requestLoggedIn:function(a){return b({url:"http://127.0.0.1:8000/api/v1/user/current/?format=json",method:"GET",headers:{"Content-Type":"application/json"}}).success(a)}}}]).service("Preference",[function(){var a={};return a.cuisine=[],{getCuisine:function(){return a.cuisine},setCuisine:function(b){for(var c=!1,d=a.cuisine.length-1;d>=0;d--)a.cuisine[d]==b.cuisine.name&&(c=!0,b.selectedStatus||a.cuisine.splice(d,1));!c&&b.selectedStatus&&a.cuisine.push(b.cuisine.name)},setParameters:function(b){a.people=b.people,a.days=b.days,a.budget=b.budget},getAll:function(){return a}}}]).factory("localStorage",["localStorageService",function(a){return{add:function(b,c){a.add(b,c)},get:function(b){return a.get(b)}}}]).factory("Basket",["$http",function(a){var b={};return{post:function(b){return a({url:"http://127.0.0.1:8000/api/v1/user/basket/?format=json",method:"POST",headers:{"Content-Type":"application/json"},data:b})},add:function(a){b.push(a)},getAll:function(){return b}}}]).factory("Tesco",["$http",function(a){return{post:function(b,c,d,e){return a({url:"http://127.0.0.1:8000/spider/?format=json",method:"POST",headers:{"Content-Type":"application/json"},data:{email:b,password:c,products:d}}).success(e)}}}]).factory("Alert",[function(){var a=[];return{add:function(b,c){a.push({msg:b,type:c})},close:function(b){a.splice(b,1)},getAll:function(){return a}}}]);